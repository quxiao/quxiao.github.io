---
layout: post
title: "ec retrieval system part one"
date: 2014-05-22 23:27:47 +0800
comments: true
categories: 
---


自己作为后端研发工程师，一直在电商项目中参与和检索相关的工作。工作的时间也不短了，一直希望能写一些文章来总结、整理下自己接触到的知识点，一方面是为了梳理自己的思路，另一方面也作为一种分享和交流。

本文简单总结一下，电商检索系统需要提供哪些功能。

搜索页面结构
======


下图是一个电商搜索结果页的基本结构：

![搜索页结构](https://www.evernote.com/shard/s30/sh/fd16350c-79fa-4be1-8d15-eea53134c5e7/221af1873a7f99885705068e333f4853/res/512bf645-05e8-4961-881f-a075de7249d6.jpg?resizeSmall&width=832)

大家可以看到，页面基本上有以下几种元素构成：

* 搜索栏
* 商品列表
* [面包屑](http://en.wikipedia.org/wiki/Breadcrumb_\(navigation\))
* 分类树
* 筛选项
* 商品推荐

每一种元素，都为用户展现了不同纬度的检索结果；同时，部分元素也为用户提供了进一步的检索、过滤功能。

搜索栏，提供了**query检索**的功能，用户最常用的寻找商品的方式；

分类树和面包屑，一方面从分类纬度展示了搜索结果，同时用户也可以对于上面的结果进行**分类检索**；

筛选项，提供了对于检索出的商品属性的聚合，同时用户又可以对于自己感兴趣的属性进行单独筛选；

商品列表，是给用户的最终结果；

商品推荐，除了自然的检索结果，还会根据用户当前的检索行为以及历史行为，进行商品推荐。

功能
======
上面提到的元素，都是为了让用户使用电商检索系统的某些功能，或者向用户展现某些功能的最终结果。下面就具体讲一下电商检索系统需要具备的基本功能：

Query检索
------
即关键词检索，用户通过输入一个检索词来描述自己的需求，比如“iphone5s”、“三星Galaxy”、“Nike运动鞋”等等。关键词检索，涉及到建立一个检索系统的一些基本步骤：

* 切词（将一段文本转化为一个一个单元，即term）
* 建立倒排索引（Inverted Index）
* 索引归并
* 排序

切词之前，首先需要确定的是：商品的哪些字段需要被切词并且建入索引。商品的标题是需要建索引的，另外，一般来说，商品的品牌名称、商家名称、分类名也是需要建索引。选择建索引字段的范围，其实是需要一些权衡的，范围选得过大，当然可以提高召回率，但这样也会出现一些bad case（比如将商品描述中一些不相关的term建进了索引），同时倒排拉链过长也会影响性能。


分类检索
------
一般来说，综合型电商网站的首页，都会有一个分类树全集，供用户直接点击查询。例如下图：

![](https://www.evernote.com/shard/s30/sh/4d2b4727-0271-41f1-b2f1-72fe91a480db/f414b1bf92c01431d582562ddeb3efb5/res/475aeb80-d662-4af8-aa47-69938a383daa.jpg?resizeSmall&width=832)

除了Query检索，用户按照商品的分类进行检索的比例也会较大。分类检索和Query检索相比，不同点只是少了切词步骤，另外将term改为商品的分类ID。

说到分类，就要涉及到分类体系。一般来说，有两种分类体系：后端分类体系，和前端分类体系。后端分类体系相对稳定，几乎不变，用户感知不到后端分类；前端分类体系结构可以很灵活，随意变化，一般由运营同学来维护。前、后端分类体系都是树状的结构，而后端分类树的任意节点可以“挂载”至一个或者多个前端分类树的叶子节点上面，这样两套分类体系之间就产生了关联。

这两个分类体系可以类比为超市的货物分类（严格来说应该是电商参考了零售行业的分类方式），一开始货物都是放在后台的库房里面的，它们按照一种分类体系（后端分类系统）来存放，非工作人员是看不到的；而等到货物需要从库房摆放到货架时，超市工作人员可以以时令、促销活动等为依据，让货架上的商品按照另一种体系（前端分类体系）进行组织，顾客只能看到这种组织形式。

排序
------

用户通过query或者分类检索出的商品结果，默认都是按照相关性排序的。（关于相关性排序，内容还是比较复杂的，另外自己也不是专门做这一块的，这里就不展开讲了）除了按照相关性进行排序，用户还可以按照其它条件进行排序，例如：

* 价格
* 折扣
* 评论数
* 好评度
* 上架时间
* ……

属性聚合
------


过滤
======
标签过滤

价格过滤

价格区间过滤

地域过滤

分类树
======


面包屑
======

Query提示
======

Query改写
======

SPU聚合
======

推荐
======
